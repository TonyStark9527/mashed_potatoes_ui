import{A as B,at as D,r as Q,aF as S,B as i,av as o,E as l,D as s,aw as E,aD as _,aE as I,U as F,C as d,an as m,aI as N,G as c,aJ as f,az as u,aK as r,ay as R,aL as g,ao as T,aM as p,aG as q,aH as U,aB as L}from"./index.c1acf0d6.js";import{Q as V}from"./QScrollArea.b771abe5.js";import{d as h}from"./dateTime.13d8e292.js";import"./format.b703539c.js";import"./touch.70a9dd44.js";const b={class:"q-gutter-none full-height full-width"},G=["src"],z={class:"text-weight-bold"},W=B({__name:"message",emits:["emitChildren"],setup(H,{expose:C,emit:v}){const M=D();let t=Q([]);function k(a){v("emitChildren",{functionName:"selectContact",data:a}),t.value.forEach(e=>{e.friendUsername===a.friendUsername&&(e.unReadMessageCount=0)})}S.get("/v1/chat/chat/contacts/"+M.getUsername()).then(a=>{a.data.code==="00000"&&a.data.result&&(t.value=a.data.result)});function w(a,n){q.info("\u60A8\u6709\u4E00\u6761\u672A\u8BFB\u6D88\u606F"),t.value.forEach(e=>{e.contactId===a&&(e.unReadMessageCount+=1,e.lastMessage=n,e.lastSendAlias=e.remark,e.lastContactDateTime=h.now("hh:mm"))}),console.log(t.value)}function x(a,n){t.value.forEach(e=>{e.contactId===a&&(e.lastMessage=n,e.lastSendAlias=e.remark,e.lastContactDateTime=h.now("hh:mm"))}),console.log(t.value)}function A(a,n){t.value.forEach(e=>{e.contactId===a&&(e.lastMessage=n,e.lastSendAlias="\u6211",e.lastContactDateTime=h.now("hh:mm"))})}return C({receiveMessageNoCurrent:w,sendMessageCurrent:A,receiveMessageCurrent:x}),(a,n)=>(i(),o("div",b,[l(V,{class:"full-width full-height q-pa-xs"},{default:s(()=>[l(E,{class:"full-height full-width"},{default:s(()=>[(i(!0),o(_,null,I(p(t),(e,y)=>(i(),o(_,null,[F((i(),d(T,{class:"q-py-md q-mx-auto full-width",clickable:"",onClick:J=>k(e)},{default:s(()=>[l(m,{avatar:""},{default:s(()=>[l(N,null,{default:s(()=>[c("img",{src:e.avatar,alt:""},null,8,G)]),_:2},1024)]),_:2},1024),l(m,null,{default:s(()=>[l(f,{lines:"1"},{default:s(()=>[u(r(e.remark),1)]),_:2},1024),l(f,{caption:"",lines:"2",style:{"min-height":"29px"}},{default:s(()=>[c("span",z,r(e.lastSendAlias),1),u(" \uFF1A"+r(e.lastMessage),1)]),_:2},1024)]),_:2},1024),l(m,{side:"",top:""},{default:s(()=>[l(f,{caption:""},{default:s(()=>[u(r(e.lastContactDateTime),1)]),_:2},1024),e.unReadMessageCount!==0?(i(),d(R,{key:0,rounded:"",color:"red",class:"q-mt-xs"},{default:s(()=>[u(r(e.unReadMessageCount>99?"99+":e.unReadMessageCount),1)]),_:2},1024)):g("",!0)]),_:2},1024)]),_:2},1032,["onClick"])),[[U]]),y!==p(t).length-1?(i(),d(L,{key:0,inset:"item"})):g("",!0)],64))),256))]),_:1})]),_:1})]))}});export{W as default};
